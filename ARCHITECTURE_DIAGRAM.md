# Architecture de SÃ©curitÃ© - Diagramme DÃ©taillÃ©

## ğŸ—ï¸ Vue d'ensemble de l'Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          COUCHE CLIENT                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚  Frontend        â”‚         â”‚  Mobile App      â”‚                     â”‚
â”‚   â”‚  Angular         â”‚         â”‚  (Future)        â”‚                     â”‚
â”‚   â”‚  Port: 4200      â”‚         â”‚                  â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚            â”‚                            â”‚                                â”‚
â”‚            â”‚ HTTP/HTTPS                 â”‚ HTTP/HTTPS                     â”‚
â”‚            â”‚ + JWT Token                â”‚ + JWT Token                    â”‚
â”‚            â”‚                            â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                            â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API GATEWAY (Port 8080)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. JwtAuthenticationFilter (Order: -1)                           â”‚  â”‚
â”‚  â”‚     â”œâ”€ Extraire token du header Authorization                     â”‚  â”‚
â”‚  â”‚     â”œâ”€ Valider le JWT (signature, expiration)                     â”‚  â”‚
â”‚  â”‚     â”œâ”€ Extraire userId, username, role                            â”‚  â”‚
â”‚  â”‚     â””â”€ Ajouter headers:                                            â”‚  â”‚
â”‚  â”‚        â€¢ X-User-Id: <userId>                                       â”‚  â”‚
â”‚  â”‚        â€¢ X-User-Username: <username>                               â”‚  â”‚
â”‚  â”‚        â€¢ X-User-Role: <role>                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  2. RoleBasedAccessFilter (Order: 0)                              â”‚  â”‚
â”‚  â”‚     â”œâ”€ Lire le header X-User-Role                                 â”‚  â”‚
â”‚  â”‚     â”œâ”€ VÃ©rifier les permissions pour le endpoint                  â”‚  â”‚
â”‚  â”‚     â””â”€ Autoriser ou Refuser (403 Forbidden)                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  3. Route Resolver                                                 â”‚  â”‚
â”‚  â”‚     â”œâ”€ /auth/** â†’ lb://USER-SERVICE                               â”‚  â”‚
â”‚  â”‚     â”œâ”€ /users/** â†’ lb://USER-SERVICE                              â”‚  â”‚
â”‚  â”‚     â”œâ”€ /defense/** â†’ lb://DEFENSE-SERVICE                         â”‚  â”‚
â”‚  â”‚     â”œâ”€ /registration/** â†’ lb://REGISTRATION-SERVICE               â”‚  â”‚
â”‚  â”‚     â””â”€ /notification/** â†’ lb://NOTIFICATION-SERVICE               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚           â”‚           â”‚           â”‚
              â–¼           â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COUCHE DÃ‰COUVERTE (EUREKA)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚  Discovery Server (Port 8761)    â”‚                        â”‚
â”‚              â”‚  â”œâ”€ USER-SERVICE                 â”‚                        â”‚
â”‚              â”‚  â”œâ”€ DEFENSE-SERVICE              â”‚                        â”‚
â”‚              â”‚  â”œâ”€ REGISTRATION-SERVICE         â”‚                        â”‚
â”‚              â”‚  â””â”€ NOTIFICATION-SERVICE         â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚           â”‚           â”‚           â”‚
              â–¼           â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COUCHE MICROSERVICES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  USER SERVICE   â”‚  â”‚ DEFENSE SERVICE â”‚  â”‚  REGISTRATION   â”‚         â”‚
â”‚  â”‚  Port: 8081     â”‚  â”‚  Port: 8083     â”‚  â”‚  SERVICE        â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  Port: 8082     â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ Endpoints:      â”‚  â”‚ Endpoints:      â”‚  â”‚                 â”‚         â”‚
â”‚  â”‚ â€¢ POST /auth/   â”‚  â”‚ â€¢ POST /create  â”‚  â”‚ Endpoints:      â”‚         â”‚
â”‚  â”‚   register      â”‚  â”‚   @PreAuthorize â”‚  â”‚ â€¢ POST /apply   â”‚         â”‚
â”‚  â”‚ â€¢ POST /auth/   â”‚  â”‚   DOCTORANT     â”‚  â”‚   @PreAuthorize â”‚         â”‚
â”‚  â”‚   login         â”‚  â”‚                 â”‚  â”‚   CANDIDAT      â”‚         â”‚
â”‚  â”‚   âœ GÃ©nÃ¨re JWT  â”‚  â”‚ â€¢ GET /my       â”‚  â”‚                 â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚   @PreAuthorize â”‚  â”‚ â€¢ POST /        â”‚         â”‚
â”‚  â”‚ â€¢ GET /users/   â”‚  â”‚   DOCTORANT     â”‚  â”‚   campaigns     â”‚         â”‚
â”‚  â”‚   {id}          â”‚  â”‚                 â”‚  â”‚   @PreAuthorize â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚ â€¢ POST /approve â”‚  â”‚   ADMIN         â”‚         â”‚
â”‚  â”‚ Security:       â”‚  â”‚   @PreAuthorize â”‚  â”‚                 â”‚         â”‚
â”‚  â”‚ â€¢ JWT Generationâ”‚  â”‚   DIRECTEUR     â”‚  â”‚ Security:       â”‚         â”‚
â”‚  â”‚ â€¢ User CRUD     â”‚  â”‚   _THESE, ADMIN â”‚  â”‚ â€¢ UserContext   â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚ â€¢ Headers       â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚ Security:       â”‚  â”‚   X-User-*      â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚ â€¢ UserContext   â”‚  â”‚                 â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚ â€¢ Headers       â”‚  â”‚                 â”‚         â”‚
â”‚  â”‚                 â”‚  â”‚   X-User-*      â”‚  â”‚                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                    â”‚                     â”‚                   â”‚
â”‚           â–¼                    â–¼                     â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚           DATABASE POSTGRESQL                             â”‚           â”‚
â”‚  â”‚  â”œâ”€ users_db        (User Service)                        â”‚           â”‚
â”‚  â”‚  â”œâ”€ defense_db      (Defense Service)                     â”‚           â”‚
â”‚  â”‚  â”œâ”€ registration_db (Registration Service)                â”‚           â”‚
â”‚  â”‚  â””â”€ notification_db (Notification Service)                â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚  NOTIFICATION   â”‚                                                     â”‚
â”‚  â”‚  SERVICE        â”‚                                                     â”‚
â”‚  â”‚  Port: 8084     â”‚                                                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                     â”‚
â”‚  â”‚                 â”‚                                                     â”‚
â”‚  â”‚ Endpoints:      â”‚                                                     â”‚
â”‚  â”‚ â€¢ POST /send    â”‚                                                     â”‚
â”‚  â”‚   @PreAuthorize â”‚                                                     â”‚
â”‚  â”‚   ADMIN,        â”‚                                                     â”‚
â”‚  â”‚   ADMINISTRATIF â”‚                                                     â”‚
â”‚  â”‚                 â”‚                                                     â”‚
â”‚  â”‚ â€¢ GET /my       â”‚                                                     â”‚
â”‚  â”‚   (Tous)        â”‚                                                     â”‚
â”‚  â”‚                 â”‚                                                     â”‚
â”‚  â”‚ Security:       â”‚                                                     â”‚
â”‚  â”‚ â€¢ UserContext   â”‚                                                     â”‚
â”‚  â”‚ â€¢ Headers       â”‚                                                     â”‚
â”‚  â”‚   X-User-*      â”‚                                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Flux d'Authentification DÃ©taillÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    
â”‚  Client  â”‚                                                    
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                    
     â”‚                                                          
     â”‚ 1. POST /auth/login                                     
     â”‚    { username, password }                               
     â”‚                                                          
     â–¼                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            
â”‚   API Gateway   â”‚                                            
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            
     â”‚                                                          
     â”‚ 2. Route vers USER-SERVICE                              
     â”‚                                                          
     â–¼                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            
â”‚  User Service   â”‚                                            
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                            
â”‚ 3. Valider      â”‚                                            
â”‚    credentials  â”‚                                            
â”‚                 â”‚                                            
â”‚ 4. GÃ©nÃ©rer JWT  â”‚                                            
â”‚    avec:        â”‚                                            
â”‚    â€¢ userId     â”‚                                            
â”‚    â€¢ username   â”‚                                            
â”‚    â€¢ role       â”‚                                            
â”‚    â€¢ expiration â”‚                                            
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            
     â”‚                                                          
     â”‚ 5. Retour JWT                                           
     â”‚                                                          
     â–¼                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            
â”‚   API Gateway   â”‚                                            
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            
     â”‚                                                          
     â”‚ 6. Retour au client                                     
     â”‚    { token: "eyJ..." }                                  
     â”‚                                                          
     â–¼                                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    
â”‚  Client  â”‚                                                    
â”‚  Store   â”‚                                                    
â”‚  Token   â”‚                                                    
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    
```

## ğŸ”’ Flux d'Autorisation DÃ©taillÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          
â”‚  Client  â”‚                                                          
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                          
     â”‚                                                                
     â”‚ 1. GET /defense/my                                            
     â”‚    Authorization: Bearer eyJ...                               
     â”‚                                                                
     â–¼                                                                
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   
â”‚                   API GATEWAY                                   â”‚   
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   
â”‚                                                                 â”‚   
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   
â”‚  â”‚ JwtAuthenticationFilter                                   â”‚  â”‚   
â”‚  â”‚                                                            â”‚  â”‚   
â”‚  â”‚ 2. Extraire token: eyJ...                                 â”‚  â”‚   
â”‚  â”‚                                                            â”‚  â”‚   
â”‚  â”‚ 3. Valider:                                               â”‚  â”‚   
â”‚  â”‚    âœ“ Signature valide?                                    â”‚  â”‚   
â”‚  â”‚    âœ“ Non expirÃ©?                                          â”‚  â”‚   
â”‚  â”‚    âœ“ Format correct?                                      â”‚  â”‚   
â”‚  â”‚                                                            â”‚  â”‚   
â”‚  â”‚ 4. Extraire claims:                                       â”‚  â”‚   
â”‚  â”‚    â€¢ userId = 123                                         â”‚  â”‚   
â”‚  â”‚    â€¢ username = "jean.dupont@example.com"                 â”‚  â”‚   
â”‚  â”‚    â€¢ role = "DOCTORANT"                                   â”‚  â”‚   
â”‚  â”‚                                                            â”‚  â”‚   
â”‚  â”‚ 5. Ajouter headers:                                       â”‚  â”‚   
â”‚  â”‚    X-User-Id: 123                                         â”‚  â”‚   
â”‚  â”‚    X-User-Username: jean.dupont@example.com               â”‚  â”‚   
â”‚  â”‚    X-User-Role: DOCTORANT                                 â”‚  â”‚   
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   
â”‚                            â”‚                                      â”‚   
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   
â”‚  â”‚ RoleBasedAccessFilter                                      â”‚  â”‚   
â”‚  â”‚                                                             â”‚  â”‚   
â”‚  â”‚ 6. Lire X-User-Role: DOCTORANT                            â”‚  â”‚   
â”‚  â”‚                                                             â”‚  â”‚   
â”‚  â”‚ 7. VÃ©rifier permissions pour /defense/my                  â”‚  â”‚   
â”‚  â”‚    â€¢ DOCTORANT autorisÃ©? âœ“ OUI                            â”‚  â”‚   
â”‚  â”‚                                                             â”‚  â”‚   
â”‚  â”‚ 8. Autoriser la requÃªte                                    â”‚  â”‚   
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   
â”‚                            â”‚                                      â”‚   
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   
â”‚  â”‚ Route Resolver                                             â”‚  â”‚   
â”‚  â”‚                                                             â”‚  â”‚   
â”‚  â”‚ 9. /defense/my â†’ lb://DEFENSE-SERVICE                      â”‚  â”‚   
â”‚  â”‚                                                             â”‚  â”‚   
â”‚  â”‚ 10. Ajouter headers propagÃ©s                              â”‚  â”‚   
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   
                             â”‚                                          
                             â”‚ Request avec headers:                    
                             â”‚ â€¢ X-User-Id: 123                         
                             â”‚ â€¢ X-User-Username: jean.dupont...        
                             â”‚ â€¢ X-User-Role: DOCTORANT                 
                             â”‚                                          
                             â–¼                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      
â”‚                    DEFENSE SERVICE                              â”‚      
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      
â”‚                                                                 â”‚      
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      
â”‚  â”‚ SecurityFilterChain                                       â”‚  â”‚      
â”‚  â”‚                                                            â”‚  â”‚      
â”‚  â”‚ 11. VÃ©rifier prÃ©sence des headers X-User-*               â”‚  â”‚      
â”‚  â”‚     âœ“ PrÃ©sents                                            â”‚  â”‚      
â”‚  â”‚                                                            â”‚  â”‚      
â”‚  â”‚ 12. Autoriser la requÃªte                                  â”‚  â”‚      
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      
â”‚                            â”‚                                      â”‚      
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      
â”‚  â”‚ DefenseController                                          â”‚  â”‚      
â”‚  â”‚                                                             â”‚  â”‚      
â”‚  â”‚ @GetMapping("/my")                                         â”‚  â”‚      
â”‚  â”‚ @PreAuthorize("hasRole('DOCTORANT')")                     â”‚  â”‚      
â”‚  â”‚                                                             â”‚  â”‚      
â”‚  â”‚ 13. Extraire userId depuis header                         â”‚  â”‚      
â”‚  â”‚     Long userId = request.getHeader("X-User-Id")          â”‚  â”‚      
â”‚  â”‚     â†’ 123                                                  â”‚  â”‚      
â”‚  â”‚                                                             â”‚  â”‚      
â”‚  â”‚ 14. ExÃ©cuter logique mÃ©tier                               â”‚  â”‚      
â”‚  â”‚     defenses = defenseService.getMyDefenses(userId)       â”‚  â”‚      
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      
â”‚                            â”‚                                      â”‚      
â”‚                            â–¼                                      â”‚      
â”‚                    15. RequÃªte DB                                â”‚      
â”‚                    SELECT * FROM defenses                         â”‚      
â”‚                    WHERE doctorant_id = 123                       â”‚      
â”‚                            â”‚                                      â”‚      
â”‚                            â–¼                                      â”‚      
â”‚                    16. Retour donnÃ©es                             â”‚      
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      
                             â”‚                                          
                             â”‚ 17. Response JSON                        
                             â”‚                                          
                             â–¼                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      
â”‚                   API GATEWAY                                   â”‚      
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      
                             â”‚                                          
                             â”‚ 18. Retour au client                     
                             â”‚                                          
                             â–¼                                          
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            
â”‚  Client  â”‚                                                            
â”‚  Affiche â”‚                                                            
â”‚  DonnÃ©es â”‚                                                            
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            
```

## ğŸ“Š Matrice de Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MATRICE DES RÃ”LES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ CANDIDAT â”‚ DOCTORANT â”‚ DIRECTEUR_   â”‚ ADMIN          â”‚
â”‚     ENDPOINT    â”‚          â”‚           â”‚    THESE     â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Authentication  â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ POST /registerâ”‚    âœ“     â”‚     âœ“     â”‚      âœ“       â”‚       âœ“        â”‚
â”‚ â€¢ POST /login   â”‚    âœ“     â”‚     âœ“     â”‚      âœ“       â”‚       âœ“        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Users           â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ GET /users    â”‚    âœ—     â”‚     âœ—     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚ â€¢ GET /users/   â”‚    âœ“*    â”‚     âœ“*    â”‚      âœ“*      â”‚       âœ“        â”‚
â”‚   {id}          â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ PUT /users/   â”‚    âœ“*    â”‚     âœ“*    â”‚      âœ“*      â”‚       âœ“        â”‚
â”‚   {id}          â”‚          â”‚           â”‚              â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Registration    â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ GET /campaignsâ”‚    âœ“     â”‚     âœ“     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚ â€¢ POST /apply   â”‚    âœ“     â”‚     âœ—     â”‚      âœ—       â”‚       âœ—        â”‚
â”‚ â€¢ POST /        â”‚    âœ—     â”‚     âœ—     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚   campaigns     â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ POST /        â”‚    âœ—     â”‚     âœ—     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚   validate      â”‚          â”‚           â”‚              â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Defense         â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ POST /create  â”‚    âœ—     â”‚     âœ“     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚ â€¢ GET /my       â”‚    âœ—     â”‚     âœ“     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚ â€¢ POST /approve â”‚    âœ—     â”‚     âœ—     â”‚      âœ“       â”‚       âœ“        â”‚
â”‚ â€¢ POST /        â”‚    âœ—     â”‚     âœ—     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚   schedule      â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ POST /jury    â”‚    âœ—     â”‚     âœ—     â”‚      âœ“       â”‚       âœ“        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Notification    â”‚          â”‚           â”‚              â”‚                â”‚
â”‚ â€¢ POST /send    â”‚    âœ—     â”‚     âœ—     â”‚      âœ—       â”‚       âœ“        â”‚
â”‚ â€¢ GET /my       â”‚    âœ“     â”‚     âœ“     â”‚      âœ“       â”‚       âœ“        â”‚
â”‚ â€¢ PUT /{id}/    â”‚    âœ“     â”‚     âœ“     â”‚      âœ“       â”‚       âœ“        â”‚
â”‚   read          â”‚          â”‚           â”‚              â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LÃ©gende:
âœ“  = AutorisÃ©
âœ—  = RefusÃ© (403 Forbidden)
âœ“* = AutorisÃ© uniquement pour ses propres donnÃ©es
```

## ğŸ”„ Comparaison Avant/AprÃ¨s

### AVANT (SÃ©curitÃ© dÃ©centralisÃ©e)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ JWT Token
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚      â”‚ Defense â”‚      â”‚  Reg.   â”‚      â”‚  Notif  â”‚
â”‚ Service â”‚      â”‚ Service â”‚      â”‚ Service â”‚      â”‚ Service â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JWT âœ“   â”‚      â”‚ JWT âœ“   â”‚      â”‚ JWT âœ“   â”‚      â”‚ JWT âœ“   â”‚
â”‚ Decode  â”‚      â”‚ Decode  â”‚      â”‚ Decode  â”‚      â”‚ Decode  â”‚
â”‚ Validateâ”‚      â”‚ Validateâ”‚      â”‚ Validateâ”‚      â”‚ Validateâ”‚
â”‚ Extract â”‚      â”‚ Extract â”‚      â”‚ Extract â”‚      â”‚ Extract â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ ProblÃ¨mes:
   â€¢ Duplication de code JWT dans chaque service
   â€¢ Maintenance difficile
   â€¢ IncohÃ©rences possibles
   â€¢ Performance (validation multiple)
```

### APRÃˆS (SÃ©curitÃ© centralisÃ©e)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ JWT Token
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    API Gateway       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JWT âœ“ Validation     â”‚
â”‚ Extraction userId    â”‚
â”‚ Extraction role      â”‚
â”‚ Ajout headers X-*    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Headers: X-User-Id, X-User-Role
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚      â”‚ Defense â”‚      â”‚  Reg.   â”‚      â”‚  Notif  â”‚
â”‚ Service â”‚      â”‚ Service â”‚      â”‚ Service â”‚      â”‚ Service â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Headers â”‚      â”‚ Headers â”‚      â”‚ Headers â”‚      â”‚ Headers â”‚
â”‚ Only    â”‚      â”‚ Only    â”‚      â”‚ Only    â”‚      â”‚ Only    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Avantages:
   â€¢ Validation JWT une seule fois
   â€¢ Code simplifiÃ© dans les microservices
   â€¢ Maintenance centralisÃ©e
   â€¢ Meilleure performance
   â€¢ CohÃ©rence garantie
```

---

**Fichier crÃ©Ã© le** : 25 dÃ©cembre 2025  
**Version** : 1.0.0
